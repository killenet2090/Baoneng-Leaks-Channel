20200610会议纪要
1.蓝牙钥匙第一期实现车主通过4G网络申请钥匙；借车授权通过蓝牙通道方式实现；
2.车主和借车人蓝牙钥匙管理第一期仅支持在线方式；
3.当前这套方案不能预防中继攻击，后续可以考虑增加一些策略预防；
4.下线检测，需考虑产线检测方案；
5.TBXO端HSM区域有效，只存储密钥、用户公钥等核心信息；
6.后面评审资料提前发出来，结合流程图评审设计文档；
7.车主功能权限需支持可设置（不同车型功能配置）；――舒琪
8.设备ID 优先取IMEI，Android9 以后用Android id，取MD5值后上传，故TSP和TBOX端设备ID 固定32位；――斯超
9.PIN码机制和蓝牙认证策略TBOX与APP协商；――斯超、利华
10.每个功能触发，产品端定义前提条件（特别是涉及手机、用户、车辆状态）；――凯宇
11.产品端提供控车车功能权限集；――凯宇
12.TSP与TBox注册接口增加角色定义；――舒琪
13.蓝牙钥匙状态定义不清晰，云端、车端蓝牙钥匙状态梳理；――舒琪、利华
14.蓝牙钥匙有效期预留开始时间和结束时间，-1表示无效，0表示永久有效，确认是否不需要单独标识；――利华
15.产品提供蓝牙钥匙角色分类及权限定义；――凯宇
16.故障码定义，云端、车端、APP端分别提供（每个接口失败原因）；――斯超、舒琪、利华

20200611会议纪要
1：APP端下载已申请的蓝牙钥匙是否需要保留
服务端不保存蓝牙钥匙，APP端下载已经申请的蓝牙钥匙此功能不开发，解决方案：走先注销再申请

2：蓝牙钥匙授权流程中tsp-tbox流程
只保留离线下载，不保留在线下发

3:蓝牙钥匙授权确认流程是否保留接受状态字段
保留

4：TBOX端主动同步蓝牙钥匙数据到tsp端，该功能是否保留
不保留，tsp端确保下发命令不丢失

5：修改蓝牙钥匙有效期、权限是并行下发还是串形下发
并行下发，tsp保证下发命令不丢失


6：蓝牙钥匙更换流程
先生成并下发新的蓝牙钥匙，再删除旧的蓝牙钥匙，如果蓝牙钥匙达到四把数量的限制，
该流程可以不受数量限制，但是最后要保证最后只有4把钥匙

7：蓝牙钥匙更换这个接口调用的前提条件需要考虑下，场景比较多
蓝牙钥匙更新由app端发起

8：车主注销被授权人蓝牙钥匙，不需要经过被授权人同意，因车主有这个权力
接受并认可上面建议

9：蓝牙钥匙即将过期，短信通知车主(被授权人)
提前一天通知

10：蓝牙钥匙编码ID后是否保留
不保留

11：项目ID （ project_id）其值来自哪里？
前期由平台初始化内置

12：版本号（version） 这个是指什么版本号？
用于并发控制，和业务无关

13：删除标志（del_flag）其值有0：正常，1：删除     这个字段用于什么使用？
数据库内置，表示该记录是否应删除

14：所属角色（auth_role_id）目前有两大类角色，车主与被授权人，这里要不要定义
统一由角色iD表示

15：缺少蓝牙钥匙使用权限字段
权限由角色决定，具体权限待定


16：api接口入参数增加手机型号字段
增加该字段

17：车辆在线手机端知道？一定是在线才请求，可以取消
采用

18：ble_skey_expire_time 默认值多少？今天确定
车主默认：生效时间+20年

19：蓝牙钥匙状态


20：增加主动推送车端后下发结果给APP接口的结果返回
增加APP接收蓝牙钥匙处理成功与否反馈接口


21：车主离线模式删除
不考虑，只考虑在线删除，app先删除蓝牙钥匙，tbox删除后告示tsp端结果，tsp告知结果到APP，tsp保证删除结果一致性

22：获取车主车辆已蓝牙钥匙记录(车主)接口，显示钥匙列表，包含借车人（手机号、手机信号、钥匙状态、有效期）
接受上面建议

23：增加车主查询某车钥匙信息（最新状态，钥匙角色、有效期、手机号、手机型号）
接受
24：车主查询某车所有钥匙操作记录（授查询时间端下的 授权、变更、注销等记录）
采用，增加变更记录表

25：借车人刷新钥匙最新状态（有效期、权限等）
借车人不能修改，只能查询

26：借车人查询接车记录（借所有车、借车时间、到期时间、还车、注销等），钥匙最新状态（有效期、权限等）
采用

27.下发更新蓝牙配置到TBOX[首次下发和更新接口共用一个接口]
共用一个mqtt的topic

28：下发更新蓝牙配置到TBOX，车端多个PIN码一起下发，不能更新
采用

29:MAC地址+车辆硬件配置
采用

30:本地注销状态（钥匙ID+注销时间）
采用

31：这里根据流程图理解，应该时tbox是否休眠，因为车辆无网络情况导致的不在线，是无法云端唤醒的，这个时候需要增加恢复机制，网络恢复后能够自动下发
唤醒机制待定，当以短信唤醒机制时，如果无法唤醒，就返回唤醒失败，当以socket机制唤醒，可以考虑重试机制

32：另外tbox休眠，能否从云端唤醒
可以

33：授权码发送方案
短信

34：车主的蓝牙钥匙定期自动的更新，七天时间是否太频繁，更新只是重新生成有效时间吗
每3个月tsp推送一次更新提醒

35：蓝牙钥匙更新，车端先删除再通知APP删除，如果车辆不在线钥匙就无法失效。建议改为同时向APP和Tbox下发删除指令
采用

36：蓝牙钥匙使用中不能进行更新、删除动作，如何定义蓝牙钥匙使用中状态
待产品开专会议定

37：注销前是否要判断蓝牙钥匙在车内还是车外
待产品开专会议定

38：ble_key_status枚举类型有哪些？
生成成功、app下发成功、TBOX下发成功、APP+Tbox下发成功、注销、过期

39：app端返回状态以字符串和中文表示
    “respCode”:”00000”,
    “respMsg”:”成功”
















